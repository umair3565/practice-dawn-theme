{% schema %}
  {
    "name": "Custom Timer",
    "settings": [
      {
        "type": "image_picker",
        "id": "bg_img",
        "label": "Background Image"
      },
      {
        "type": "select",
        "id": "content_alignment",
        "label": "Content Alignment",
        "default": "flex-end",
        "info": "For Desktop only",
        "options": [
          {
            "value": "flex-start",
            "label": "Left"
          }, {
            "value": "center",
            "label": "Center"
          }, {
            "value": "flex-end",
            "label": "Right"
          }
        ]
      },
      {
        "type": "text",
        "id": "sale_date",
        "label": "Enter Sale Date",
        "info": "Use format (YYYY-MM-DD-HH:MM)"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Uncover Timeless Fragrances"
      }, {
        "type": "color",
        "id": "heading_color",
        "label": "Heading Color",
        "default": "#FFFFFF"
      }, {
        "type": "textarea",
        "id": "text",
        "label": "Description Text",
        "default": "Explore our curated selection of on-sale items and indulge in luxury for less."
      }, {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#FFFFFF"
      }, {
        "type": "text",
        "id": "button_text",
        "label": "Button Text",
        "default": "View Sale"
      }, {
        "type": "color",
        "id": "button_color",
        "label": "Button Text Color",
        "default": "#E8E8E8"
      }, {
        "type": "url",
        "id": "button_link",
        "label": "Button Link"
      }, {
        "type": "color",
        "id": "timer_color",
        "label": "Time Color",
        "default": "#FFFFFF"
      }, {
        "type": "color",
        "id": "timer_text_color",
        "label": "Timer Text Color",
        "default": "#FFFFFF"
      }
    ],
    "presets": [
      {
        "name": "Custom Timer"
      }
    ]
  }
{% endschema %}

<style>
  .timer-section {
    height: 700px;
    width: 100%;
    display: flex;
    align-items: stretch;
    position: relative;
  }

  .timer-section .bg-img {
    position: absolute;
    z-index: -1;
    object-position: center;
    object-fit: cover;
  }

  .timer-container {
    max-width: var(--page-width);
    width: 100%;
    margin: 0 auto;
    padding: 80px var(--container-padding-desktop);
    display: flex;
    justify-content: flex-end;
  }

  .timer-content {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 100%;
    align-items: {{ section.settings.content_alignment }};
    min-height: 580px;
  }

  .timer-content .top-content {
    padding-bottom: 30px;
    max-width: 380px;

    {% case section.settings.content_alignment %}
    {% when 'flex-start' %}
      text-align: left;
    {% when 'center' %}
      text-align: center;
    {% when 'flex-end' %}
      text-align: right;
    {% endcase %}
  }

  .timer-content .top-content h3 {
    color: {{ section.settings.heading_color }};
    font-weight: 400;
    font-size: 32px;
    line-height: 40px;
  }

  .timer-content .top-content p {
    margin-top: 16px;
    font-size: 16px;
    line-height: 1.6;
    max-width: 480px;
    color: {{ section.settings.text_color }};
  }

  .timer-content .top-content .link-btn {
    margin-top: 32px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    font-size: 16px;
    line-height: 24px;
    color: {{ section.settings.button_color }};
  }

  .bottom-content .timer {
    display: flex;
    gap: 32px;
  }

  .bottom-content .timer p:first-child {
    font-weight: 300;
    font-size: 64px;
    line-height: 72px;
    letter-spacing: -2.56px;
    color: {{ section.settings.timer_color }};
  }

  .bottom-content .timer p:last-child {
    color: {{ section.settings.timer_text_color }};
    font-weight: 500;
    font-size: 18px;
    line-height: 26px;
    text-align: center;
  }

  .days,
  .hours,
  .minutes,
  .seconds {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  @media (max-width: 1200px) {
    .timer-container {
      justify-content: center;
      text-align: center;
      padding: 60px var(--container-padding-tablet);
    }
  }

  @media (max-width: 768px) {

    .timer-container {
      padding: 40px var(--container-padding-mobile);
    }

    .timer-content {
      align-items: center;
    }

    .timer-content .top-content {
      text-align: center;
    }

  }

  @media (max-width: 425px) {

    .timer-content .top-content h3 {
      font-size: 28px;
    }

    .bottom-content .timer {
      gap: 10px;
    }

    .bottom-content .timer p:first-child {
      font-size: 42px;
      line-height: 36px;
      letter-spacing: -1.56px;
    }

    .bottom-content .timer p:last-child {
      font-size: 16px;
      line-height: 30px;
    }
  }
</style>

{% if section.settings.sale_date != blank %}
  <section class="timer-section" data-sale-date="{{ section.settings.sale_date | escape }}">
    {% if section.settings.bg_img != blank %}
      {{ section.settings.bg_img
 | image_url: width: 1600
 | image_tag: alt: 'Background image', class: 'bg-img', width: '100%', height: '100%'
      }}
    {% else %}
      <img
        class="bg-img"
        width="100%"
        height="100%"
        src="{{ 'timer-bg.jpg' | asset_url }}"
        alt="Background image">
    {% endif %}

    <div class="timer-container">
      <div class="timer-content">
        <div class="top-content">
          <h3>{{ section.settings.heading }}</h3>

          <p>{{ section.settings.text }}</p>

          {% if section.settings.button_text != blank %}
            <a href="{{ section.settings.button_link }}" class="link-btn">
              <img
                src="{{ 'link-icon.svg' | asset_url }}"
                width="10"
                height="10"
                alt="">
              <span>{{ section.settings.button_text }}</span>
            </a>
          {% endif %}
        </div>

        <div class="bottom-content">
          <div class="timer">
            <div class="days">
              <p>00</p>
              <p>Days</p>
            </div>
            <div class="hours">
              <p>00</p>
              <p>Hours</p>
            </div>
            <div class="minutes">
              <p>00</p>
              <p>Minutes</p>
            </div>
            <div class="seconds">
              <p>00</p>
              <p>Seconds</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const timerSection = document.querySelector('.timer-section');
    if (!timerSection) return;
  
    const saleDateStr = timerSection.getAttribute('data-sale-date');
    if (!saleDateStr) {
      timerSection.style.display = 'none';
      return;
    }
  
    const parts = saleDateStr.split('-');
    if (parts.length < 4) {
      timerSection.style.display = 'none';
      return;
    }
  
    const [year, month, day, time] = parts;
    const [hour, minute] = time.split(':');
    const targetDate = new Date(year, month - 1, day, hour, minute).getTime();
  
    const now = new Date().getTime();
    if (targetDate <= now) {
      timerSection.style.display = 'none';
      return;
    }
  
    const daysEl = timerSection.querySelector('.days p:first-child');
    const hoursEl = timerSection.querySelector('.hours p:first-child');
    const minutesEl = timerSection.querySelector('.minutes p:first-child');
    const secondsEl = timerSection.querySelector('.seconds p:first-child');
  
    function updateTimer() {
      const currentTime = new Date().getTime();
      const distance = targetDate - currentTime;
  
      if (distance <= 0) {
        clearInterval(timerInterval);
        timerSection.style.display = 'none';
        return;
      }
  
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
  
      daysEl.textContent = String(days).padStart(2, '0');
      hoursEl.textContent = String(hours).padStart(2, '0');
      minutesEl.textContent = String(minutes).padStart(2, '0');
      secondsEl.textContent = String(seconds).padStart(2, '0');
    }
  
    updateTimer();
    const timerInterval = setInterval(updateTimer, 1000);
  });
</script>