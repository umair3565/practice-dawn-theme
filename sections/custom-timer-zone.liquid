{% schema %}
  {
    "name": "Custom Timer Zone",
    "settings": [
      {
        "type": "header",
        "content": "Background Images"
      },
      {
        "type": "image_picker",
        "id": "bg_desktop",
        "label": "Desktop Background Image"
      },
      {
        "type": "image_picker",
        "id": "bg_mobile",
        "label": "Mobile Background Image"
      },
      {
        "type": "select",
        "id": "section_height",
        "label": "Section Height",
        "default": "500",
        "options": [
          {
            "value": "400",
            "label": "400px"
          },
          {
            "value": "500",
            "label": "500px"
          },
          {
            "value": "600",
            "label": "600px"
          },
          {
            "value": "700",
            "label": "700px"
          }, {
            "value": "800",
            "label": "800px"
          }, {
            "value": "900",
            "label": "900px"
          }
        ]
      }, {
        "type": "range",
        "id": "overlay_opacity",
        "label": "Overlay Opacity",
        "min": 0,
        "max": 100,
        "step": 5,
        "default": 40,
        "unit": "%"
      }, {
        "type": "color",
        "id": "overlay_color",
        "label": "Overlay Color",
        "default": "#000000"
      }, {
        "type": "header",
        "content": "Countdown Settings"
      }, {
        "type": "text",
        "id": "sale_date",
        "label": "Target Date",
        "info": "Format: YYYY-MM-DD (date only)"
      }, {
        "type": "text",
        "id": "timer_time",
        "label": "Target Time",
        "info": "Format: HH:MM (time only)"
      }, {
        "type": "select",
        "id": "time_zone",
        "label": "Time Zone",
        "default": "Asia/Karachi",
        "options": [
          {
            "value": "UTC",
            "label": "UTC"
          },
          {
            "value": "Europe/London",
            "label": "London (GMT/UTC)"
          },
          {
            "value": "Europe/Paris",
            "label": "Paris (CET)"
          },
          {
            "value": "America/New_York",
            "label": "New York (EST)"
          }, {
            "value": "America/Los_Angeles",
            "label": "Los Angeles (PST)"
          }, {
            "value": "Asia/Kolkata",
            "label": "Kolkata (IST)"
          }, {
            "value": "Asia/Karachi",
            "label": "Karachi / Islamabad (PKT)"
          }, {
            "value": "Asia/Tokyo",
            "label": "Tokyo (JST)"
          }, {
            "value": "Australia/Sydney",
            "label": "Sydney (AEDT)"
          }
        ]
      }, {
        "type": "text",
        "id": "heading_small",
        "label": "Small Heading",
        "default": "It starts with one."
      }, {
        "type": "text",
        "id": "heading",
        "label": "Main Heading",
        "default": "Our first collab."
      }, {
        "type": "header",
        "content": "Content Placement & Style"
      }, {
        "type": "select",
        "id": "content_position",
        "label": "Content Placement",
        "default": "flex-end",
        "options": [
          {
            "value": "flex-start",
            "label": "Left"
          }, {
            "value": "center",
            "label": "Center"
          }, {
            "value": "flex-end",
            "label": "Right"
          }
        ]
      }, {
        "type": "select",
        "id": "text_alignment",
        "label": "Text Alignment",
        "default": "center",
        "options": [
          {
            "value": "left",
            "label": "Left"
          }, {
            "value": "center",
            "label": "Center"
          }, {
            "value": "right",
            "label": "Right"
          }
        ]
      }, {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#FFFFFF"
      }, {
        "type": "color",
        "id": "content_bg",
        "label": "Content Background Color",
        "default": "rgba(0,0,0,0)"
      }, {
        "type": "header",
        "content": "Section Spacing"
      }, {
        "type": "select",
        "id": "section_width",
        "label": "Section Width",
        "default": "1440",
        "options": [
          {
            "value": "1440",
            "label": "Full Width (1440px)"
          }, {
            "value": "1200",
            "label": "Boxed (1200px)"
          }, {
            "value": "1000",
            "label": "Boxed (1000px)"
          }, {
            "value": "800",
            "label": "Boxed (800px)"
          }
        ]
      }, {
        "type": "range",
        "id": "section_padding_top",
        "label": "Top Padding",
        "min": 0,
        "max": 200,
        "step": 5,
        "default": 80,
        "unit": "px"
      }, {
        "type": "range",
        "id": "section_padding_bottom",
        "label": "Bottom Padding",
        "min": 0,
        "max": 200,
        "step": 5,
        "default": 80,
        "unit": "px"
      }
    ],
    "presets": [
      {
        "name": "Custom Timer Zone"
      }
    ]
  }
{% endschema %}

<style>

  .timer-section {
    position: relative;
    width: 100%;
    height: {{ section.settings.section_height }}px;
    padding-top: {{ section.settings.section_padding_top }}px;
    padding-bottom: {{ section.settings.section_padding_bottom }}px;
    overflow: hidden;
  }

  .timer-bg img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .timer-bg .bg-mobile {
    display: none;
  }

  .timer-overlay {
    position: absolute;
    inset: 0;
    background-color: {{ section.settings.overlay_color }};
    opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};
    z-index: 1;
  }

  .timer-container {
    position: relative;
    z-index: 2;
    display: flex !important;
    justify-content: {{ section.settings.content_position }};
    align-items: center;
    text-align: {{ section.settings.text_alignment }};
    height: 100%;
    padding: 20px;
  }


  .timer-content {
    background-color: {{ section.settings.content_bg }};
    color: {{ section.settings.text_color }};
  }

  .small-heading {
    font-size: 48px;
    line-height: 1.2;
    letter-spacing: 1px;
    opacity: 0.8;
  }

  .timer-content h2 {
    font-size: 48px;
    font-weight: 600;
  }

  .sub-heading {
    margin-top: 32px;
    font-size: 32px;
    letter-spacing: 2px;
    opacity: 0.9;
  }

  .timer {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
  }

  .timer-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }

  .timer-item span {
    display: inline-block;
    font-size: 100px;
    font-weight: 300;
    line-height: 1.5;
  }


  .timer-item span::after {
    content: ":";
    margin-left: 8px;
    font-size: 100px;
    font-weight: 300;
    opacity: 0.7;
  }


  .timer-item:last-child span::after {
    content: "";
  }

  .timer-item small {
    margin-top: 8px;
    font-size: 20px;
    letter-spacing: 1px;
    opacity: 0.7;
  }


  @media (max-width: 768px) {
    .timer-bg .bg-desktop {
      display: none;
    }
    .timer-bg .bg-mobile {
      display: block;
    }
    .timer-container {
      justify-content: center;
      padding: 60px;
    }

  }

  @media (max-width: 480px) {
    .timer-content h2 {
      font-size: 36px;
    }
    .timer-item span {
      font-size: 52px;
    }
    .timer-item small {
      font-size: 14px;
    }
    .timer-item span::after {
      font-size: 42px;
      margin-left: 4px;
    }
  }
</style>


<section
  class="timer-section"
  data-sale-date="{{ section.settings.sale_date | escape }}"
  data-timer-time="{{ section.settings.timer_time | escape }}"
  data-time-zone="{{ section.settings.time_zone | escape }}">

  <div class="timer-bg">
    {% if section.settings.bg_desktop != blank %}
      {{ section.settings.bg_desktop | image_url: width: 2000 | image_tag: class: 'bg-desktop', alt: 'Timer background desktop', width: '2000', height: '1000' }}
    {% endif %}
    {% if section.settings.bg_mobile != blank %}
      {{ section.settings.bg_mobile | image_url: width: 900 | image_tag: class: 'bg-mobile', alt: 'Timer background mobile', width: '900', height: '1200' }}
    {% endif %}
  </div>

  <div class="timer-overlay"></div>

  <div class="timer-container">
    <div class="timer-content">
      <p class="small-heading">{{ section.settings.heading_small }}</p>
      <h2>{{ section.settings.heading }}</h2>

      {% if section.settings.sale_date != blank %}
        <p class="sub-heading">
          {{ section.settings.sale_date | date: "%B %d" | upcase }}
        </p>
      {% endif %}


      <div class="timer">
        <div class="timer-item">
          <span data-days>00</span>
          <small>DAYS</small>
        </div>
        <div class="timer-item">
          <span data-hours>00</span>
          <small>HOURS</small>
        </div>
        <div class="timer-item">
          <span data-minutes>00</span>
          <small>MINS</small>
        </div>
        <div class="timer-item">
          <span data-seconds>00</span>
          <small>SECS</small>
        </div>
      </div>


    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  const sections = document.querySelectorAll('.timer-section');
  if (!sections.length) return;
  
  sections.forEach((section) => {
    const dateStr = section.getAttribute('data-sale-date');
    const timeStr = section.getAttribute('data-timer-time');
    const timeZone = section.getAttribute('data-time-zone') || 'UTC';
  
    if (!dateStr || !timeStr) { section.style.display = 'none'; return; }
  
    const [year, month, day] = dateStr.split('-');
    const [hour, minute] = timeStr.split(':');
  
    // Create a UTC string in ISO format
    const targetDateUTC = new Date(Date.UTC(year, month-1, day, hour, minute));
  
    // Convert to selected timezone offset
    function getTargetTime() {
      try {
        return new Date(targetDateUTC.toLocaleString('en-US', { timeZone }));
      } catch(e) {
        return targetDateUTC;
      }
    }
  
    const daysEl = section.querySelector('[data-days]');
    const hoursEl = section.querySelector('[data-hours]');
    const minutesEl = section.querySelector('[data-minutes]');
    const secondsEl = section.querySelector('[data-seconds]');
  
    function updateTimer() {
      const targetTime = getTargetTime().getTime();
      const diff = targetTime - Date.now();
  
      if (diff <= 0) { section.style.display='none'; clearInterval(interval); return; }
  
      daysEl.textContent = String(Math.floor(diff / 86400000)).padStart(2,'0');
      hoursEl.textContent = String(Math.floor(diff / 3600000) % 24).padStart(2,'0');
      minutesEl.textContent = String(Math.floor(diff / 60000) % 60).padStart(2,'0');
      secondsEl.textContent = String(Math.floor(diff / 1000) % 60).padStart(2,'0');
    }
  
    updateTimer();
    const interval = setInterval(updateTimer, 1000);
  });
  });
</script>