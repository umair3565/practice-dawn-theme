{% schema %}
  {
    "name": "Custom Announcement Bar",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_icons",
        "label": "Show navigation icons",
        "default": true
      }, {
        "type": "range",
        "id": "autoplay_speed",
        "label": "Autoplay delay (seconds)",
        "default": 3,
        "min": 1,
        "max": 10,
        "step": 1
      }, {
        "type": "color",
        "id": "text_color",
        "label": "Text color",
        "default": "#E8E8E8"
      }
    ],
    "blocks": [
      {
        "type": "slide",
        "name": "Announcement Slide",
        "settings": [
          {
            "type": "text",
            "id": "slide_text",
            "label": "Announcement text",
            "default": "Add your announcement Text here"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Custom Announcement Bar",
        "category": "Announcement",
        "blocks": [
          {
            "type": "slide"
          }, {
            "type": "slide"
          }, {
            "type": "slide"
          }
        ]
      }
    ]
  }
{% endschema %}

<style>

  .announcement-container {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    z-index: 1500;
    transition: all 0.3s ease;
    background: transparent;
    height: 40px;
    display: flex;
    justify-content: center;
    text-align: center;
  }

  .announcement-bar-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 600px;
    width: 100%;
    gap: 20px;
  }

  .announcementBarSwiper {
    flex: 1;
    overflow: hidden;
  }

  .announcementBarSwiper .swiper-slide .slide-text {
    font-weight: 500;
    font-size: 14px;
    line-height: 20px;
    text-align: center;
    color: {{ section.settings.text_color }};
  }

  .announcementBarSwiper .swiper-wrapper {
    display: flex;
    align-items: center;
    font-weight: 500;
  }

  .announcement-swiper-prev,
  .announcement-swiper-next {
    width: 6px;
    height: 12px;
    cursor: pointer;
    flex-shrink: 0;
    pointer-events: auto;
  }

  .announcement-container.scrolled {
    background-color: white !important;
  }

  .announcement-container.scrolled .swiper-slide .slide-text {
    color: var(--text-secondary) !important;
  }

  .arrow {
    transition: filter 0.3s ease;
    filter: brightness(0) invert(1);
  }

  .announcement-container.scrolled .arrow {
    filter: brightness(0) invert(0);
  }

  @media (max-width: 768px) {
    .announcement-bar-inner {
      max-width: 100%;
      gap: 10px;
      padding: 0 var(--container-padding-mobile);
    }

    .announcement-bar-inner .swiper-slide {
      font-size: 14px;
    }

    .announcement-swiper-prev,
    .announcement-swiper-next {
      width: 6px;
    }
  }
</style>

<section class="announcement-container" id="announcementBar">

  <div class="announcement-bar-inner">
    {% if section.settings.show_icons %}
      <img
        width="100%"
        height="100%"
        src="{{ 'left-arrow.svg' | asset_url }}"
        alt="Previous"
        class="announcement-swiper-prev arrow">
    {% endif %}

    <div class="swiper announcementBarSwiper">
      <div class="swiper-wrapper">
        {% if section.blocks.size > 0 %}
          {% for block in section.blocks %}
            <div class="swiper-slide">
              <p class="slide-text">{{ block.settings.slide_text }}</p>
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    {% if section.settings.show_icons %}
      <img
        width="100%"
        height="100%"
        src="{{ 'right-arrow.svg' | asset_url }}"
        alt="Next"
        class="announcement-swiper-next arrow">
    {% endif %}
  </div>

</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  
  new Swiper('.announcementBarSwiper', {
    slidesPerView: 'auto',
    centeredSlides: true,
    loop: true,
    navigation: {
      nextEl: '.announcement-swiper-next',
      prevEl: '.announcement-swiper-prev',
    },
    autoplay: {
      delay: {{ section.settings.autoplay_speed | times: 1000 }},
      disableOnInteraction: false,
    },
    speed: 600,
  });
  
  const announcementBar = document.getElementById('announcementBar');
  
  if (announcementBar) {
    {% if template.name == 'index' or template.name == 'collection' %}

        window.addEventListener('scroll', function () {
        if (window.scrollY >= 100) {
          announcementBar.classList.add('scrolled');
        } else {
          announcementBar.classList.remove('scrolled');
        }
      });

      {% else %}
      announcementBar.classList.add('scrolled');
    {% endif %}
  }
  
  });
</script>